---
- name: Provision Kubernetes Worker Nodes
  hosts: workers
  become: true

  tasks:
    - name: Copy join command from controller
      fetch:
        src: /root/join_command
        dest: /tmp/join_command
        flat: yes

    - name: Join the cluster
      command: "{{ lookup('file', '/tmp/join_command') }}"
      register: join_cluster
      changed_when: "'This node has joined the cluster' not in join_cluster.stdout"
