---
- name: Install Helm
  hosts: controller
  become: yes
  vars:
    helm_version: "v3.14.0"

  tasks:
    - name: Download Helm
      get_url:
        url: "https://get.helm.sh/helm-{{ helm_version }}-linux-amd64.tar.gz"
        dest: /tmp/helm-{{ helm_version }}-linux-amd64.tar.gz

    - name: Extract and Install Helm
      unarchive:
        src: /tmp/helm-{{ helm_version }}-linux-amd64.tar.gz
        dest: /usr/local/bin
        remote_src: yes
        extra_opts: [--strip-components=1]

    - name: Initialize Helm
      command: helm repo add stable https://charts.helm.sh/stable && helm repo update
